<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Gae Blog</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="/assets/stylesheets/main.css ">
    <link rel="canonical" href="https://www.gaeblog.com/page8/">
    <link rel="alternate" type="application/rss+xml" title="Gae Blog" href="https://www.gaeblog.com/assets/feed.xml ">



    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-100686813-1', 'auto');
      ga('send', 'pageview');

    </script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Page 8 of 9 for Gae Blog</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Gae Blog" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://www.gaeblog.com/page8/" />
<meta property="og:url" content="https://www.gaeblog.com/page8/" />
<meta property="og:site_name" content="Gae Blog" />
<link rel="prev" href="https://www.gaeblog.com/page7" />
<link rel="next" href="https://www.gaeblog.com/page9" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Gae Blog" />
<script type="application/ld+json">
{"@type":"WebPage","headline":"Gae Blog","url":"https://www.gaeblog.com/page8/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">Gae Blog</a>
        <small>Software Engineer@Amazon</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/search/">
                        
                            <i class="fa fa-search"></i>Search
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" index>
    <div class="left" >
       <h1>Blog about Everything</h1>
       <small>Notes, Word Salad, etc.</small>
        <hr>
        <ul>
            
              <li>
                <h1>
                  <a class="post-link" href="/2017/06/08/AWS-Introduction/">AWS Introduction</a>
                </h1>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-06-08
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>Yanxi Chen
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Cloud Computing" title="Category: Cloud Computing" rel="category">Cloud Computing</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#AWS" title="Tag: AWS" rel="tag">AWS</a>&nbsp;
    
        <a href="/tag/#IaaS" title="Tag: IaaS" rel="tag">IaaS</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#amazon-web-service" id="markdown-toc-amazon-web-service">Amazon Web Service</a></li>
</ul>

<h2 id="amazon-web-service">Amazon Web Service</h2>

<p>Amazon provides web-service based access to its infrastructure via two separate but interoperating facilities:</p>
<ul>
  <li>Elastic Compute Cloud (EC2) – virtual machines, network, block storage, identity management</li>
  <li>Simple storage service (S3) – scalable, eventually consistent object storageIn addition, it also offers a number of higher level services that make use of this infrastructure, such as</li>
  <li>NoSQL database: <a href="http://aws.amazon.com/dynamodb/">DynamoDB</a></li>
  <li>SQL database: <a href="http://aws.amazon.com/rds/">RDS</a></li>
  <li>Data warehousing: <a href="http://aws.amazon.com/redshift/">Redshift</a></li>
  <li>In-memory object caching: <a href="http://aws.amazon.com/elasticache/">Elasticache</a></li>
  <li>Archival storage: <a href="http://aws.amazon.com/glacier/">Glacier</a></li>
  <li>Network overlays: <a href="http://aws.amazon.com/vpc/">VPC</a></li>
  <li>Authoritative DNS: <a href="http://aws.amazon.com/route53/">Route53</a></li>
  <li>Web caching and CDN: <a href="http://aws.amazon.com/cloudfront/">CloudFront</a></li>
  <li>Hadoop: <a href="http://aws.amazon.com/elasticmapreduce/">Elastic Map Reduce</a></li>
  <li>Data stream processing: <a href="http://aws.amazon.com/kinesis/">Kinesis</a></li>
  <li>Streaming app support: <a href="http://aws.amazon.com/appstream/">AppStream</a></li>
  <li>Search: <a href="http://aws.amazon.com/cloudsearch/">CloudSearch</a></li>
  <li>Workflow: <a href="http://aws.amazon.com/swf/">SWF</a></li>
  <li>Bulk email: <a href="http://aws.amazon.com/ses/">SES</a></li>
  <li>Alerting: <a href="http://aws.amazon.com/sns/">SNS</a></li>
  <li>Reliable queuing: <a href="http://aws.amazon.com/sqs">SQS</a></li>
  <li>Media transcoding: <a href="http://aws.amazon.com/elastictranscoder/">ElasticTranscoder</a></li>
  <li>Performance monitoring: <a href="http://aws.amazon.com/cloudwatch/">CloudWatch</a></li>
  <li>Web containers: <a href="http://aws.amazon.com/elasticbeanstalk/">ElasticBeanstalk</a></li>
  <li>Image templating: <a href="http://aws.amazon.com/cloudformation/">Cloud Formation</a></li>
  <li>Application configuration and deployment: <a href="http://aws.amazon.com/opsworks/">OpsWorks</a></li>
  <li>Secure key management: <a href="http://aws.amazon.com/cloudhsm/">CloudHSM</a></li>
  <li>logging and auditing: <a href="http://aws.amazon.com/cloudtrail/">CloudTrail</a></li>
  <li>Docker: <a href="https://aws.amazon.com/ecr/">Container Registry</a> and <a href="https://aws.amazon.com/ecs/">Service</a>All services are accessible via SOAP, REST, command-line tools (Java), <a href="http://aws.amazon.com/tools/">SDKs</a> (Java, PHP, .Net, Python, Ruby, iOS, Android) graphical <a href="https://aws.amazon.com/console/?nc1=f_m">AWS console</a>.</li>
</ul>


                </div>
                <div class="read-all">
                    <a  href="/2017/06/08/AWS-Introduction/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h1>
                  <a class="post-link" href="/2017/06/08/File-System/">File System</a>
                </h1>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-06-08
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>Yanxi Chen
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Operating System" title="Category: Operating System" rel="category">Operating System</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#File System" title="Tag: File System" rel="tag">File System</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#the-unix-file-system" id="markdown-toc-the-unix-file-system">The Unix File System</a>    <ul>
      <li><a href="#what-is-a-unix-file" id="markdown-toc-what-is-a-unix-file">What is a Unix file?</a></li>
      <li><a href="#problem-disks-are-organized-as-collections-of-blocks" id="markdown-toc-problem-disks-are-organized-as-collections-of-blocks">Problem: disks are organized as collections of “blocks”</a></li>
      <li><a href="#what-should-the-kernal-do" id="markdown-toc-what-should-the-kernal-do">What should the kernal do?</a></li>
    </ul>
  </li>
</ul>

<h1 id="the-unix-file-system">The Unix File System</h1>

<p>I’m not particularly fond of Chapters 11 and 12 in S &amp; G, so I’m augmenting them with musings concerning the Unix file system. The primary reference is “The Design of the Unix Operating System” by Maurice Bach, Chapter 4, but almost any book on Unix internals will contain this information.</p>

<h3 id="what-is-a-unix-file">What is a Unix file?</h3>

<ul>
  <li>abstraction: sequential stream of bytes</li>
  <li>system calls: read(), write(), open(), close(), seek()</li>
</ul>

<h3 id="problem-disks-are-organized-as-collections-of-blocks">Problem: disks are organized as collections of “blocks”</h3>

<ul>
  <li>a disk address is some kind of tuple
    <ul>
      <li>track/sector</li>
      <li>cylinder/platter/sector</li>
    </ul>
  </li>
  <li>all Unix disk-drivers translate disk addresses to logical block numbers (1..n)</li>
  <li>through the block driver interface you can request block “k” and the driver 
will convert that to a track/sector tuple.</li>
</ul>

<h3 id="what-should-the-kernal-do">What should the kernal do?</h3>

<ul>
  <li>The kernel must be able to translate user-process system calls (which 
refer to a file as a sequence of bytes) to logical block numbers which
are then translated into disk addresses by the individual disk driver.</li>
</ul>


                </div>
                <div class="read-all">
                    <a  href="/2017/06/08/File-System/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h1>
                  <a class="post-link" href="/2017/06/08/Memory-Management/">Memory Management</a>
                </h1>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-06-08
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>Yanxi Chen
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Operating System" title="Category: Operating System" rel="category">Operating System</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Memory" title="Tag: Memory" rel="tag">Memory</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#linking-and-loading" id="markdown-toc-linking-and-loading">Linking and Loading</a></li>
</ul>

<p>This lecture will attempt to cover the various concepts that are important to the memory management functions that most operating systems must perform.</p>

<h2 id="linking-and-loading">Linking and Loading</h2>

<ul>
  <li>program addresses are logical, machine addresses are physical</li>
  <li>linking – resolving logical addresses relative to the entire program
    <ul>
      <li>.o files have logical addresses</li>
      <li>when multiple .o files are linked, addresses must be altered</li>
      <li>symbol table contains necessary information</li>
      <li>Unix utility <strong>ld()</strong> is the linker</li>
    </ul>
  </li>
  <li>loading – the introduction of a program into physical memory</li>
  <li>logical program addresses must be converted to physical machine addresses</li>
</ul>

<p>When the code is loaded into memory, the compiler generates code so that variables are accessed via offsets from memory locations that are determined when the program boots. For example, consider the fictitious code depicted in the following figure:</p>

<p><img src="https://www.gaeblog.com/assets/Memory-Management-fig1.png" alt="" /></p>

<p>The local variables <em>A,B, and C</em> are all addressed via the <em>SP</em> register by computing a memory address by adding the contents of the <em>SP</em> to the contents of an offset register (<em>R1</em> in the figure).</p>

<p>Thus, when the program is loaded into memory, the loader “knows” that the stack pointer will start at location <em>0x7f00000c</em> and it tells the OS to initialize the <em>SP</em> with this value. The call to <em>foo()</em> can been compiled to pus the space for three integers onto the stack and the code accesses the variables indirectly through the <em>SP</em> and individual offsets for each variable.</p>

<p>That’s fine for the stack where there is always a machine register that defines the top of the stack. CPUs do not have explicit registers for the other segments in a Linux a.out process image, however. Thus, when accessing global variables, the compiler must either “burn” a register for the start of the data segment (which is costly since there aren’t enough registers as it is) or it must “hard code” addresses (as in the following figure):</p>

<p><img src="https://www.gaeblog.com/assets/Memory-Management-fig2.png" alt="" /></p>

<p>Again, the compiler has chosen to access memory via indirect addressing, but it does so with address constants to save registers for computation.</p>

<p>This work fine when</p>

<ul>
  <li>the program is always loaded at the same location in memory</li>
  <li>the program is the only program in memory</li>
</ul>

<p>However, consider what happens if there are to be two processes in memory at the same time.</p>

<p><img src="https://www.gaeblog.com/assets/Memory-Management-fig3.png" alt="" /></p>

<p>On this figure, <em>Proc1</em> has been loaded into the top half of the physical memory and <em>Proc 2</em> into the bottom half. Presumably the OS is prepared to switch back and forth between the two processes using time slicing and context switching.</p>

<p>However notice that if it is physical memory alone, the compiler must “know” where the program will be loaded so that it can adjust the address constants appropriately. The stack pointer isn’t a problem, but the global variables are.</p>

<p>Worse, in this scenario, one program can read and update the variables belonging to the other simply by addressing the memory. For example, if <em>Proc 1</em> executes the instruction sequence</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LD SP, 0x7f00000C
</code></pre></div></div>

<p>it will suddenly be accessing the stack variables of <em>Proc 2</em>.</p>


                </div>
                <div class="read-all">
                    <a  href="/2017/06/08/Memory-Management/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h1>
                  <a class="post-link" href="/2017/06/08/System-Calls/">System Calls</a>
                </h1>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-06-08
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>Yanxi Chen
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Operating System" title="Category: Operating System" rel="category">Operating System</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Syscall" title="Tag: Syscall" rel="tag">Syscall</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#system-calls" id="markdown-toc-system-calls">System Calls</a></li>
</ul>

<h2 id="system-calls">System Calls</h2>

<p>In the C lecture we discussed the concept of separate compilation and C “libraries.” Functions like <em>printf()</em>, <em>strlen()</em> and <em>strncpy()</em> are all implemented as libraries for Linux. That is, someone, some time wrote the following code (or something like it):</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">strlen</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">string</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>That’s pretty much all <em>strlen()</em> does. As mentioned, this function is included as part of a default library called <em>libc.a</em> that is automatically linked with any C program (by default).</p>

<p>There are some functions that your program also gets that are not implemented as libraries. Instead, these functions (which all must manipulate data structures that are shared among all processes in the system) are implemented <strong>directly by the operating system</strong>. That is, they act like they are loaded as part of a default library, but in fact they are part of the resident OS. These kinds of functions are called <strong>system calls</strong> because they are calls to the system (the OS).</p>

<p>Knowing whether a Linux feature is implemented as a library or system call isn’t exactly easy. As a rule, the section section of the manual (section 2) are the basic system calls. If you type</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man 2 <span class="nb">read</span>
</code></pre></div></div>

<p>you will see the system call <em>read()</em> listed, but type</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man 3 <span class="nb">read</span>
</code></pre></div></div>

<p>and it won’t appear. However,</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man 3 fwrite
</code></pre></div></div>

<p>shows the man page for the <em>fwrite()</em> library call.</p>

<p>This isn’t a very satisfying or accurate way to determine whether a call is a default library call or a system call but it will get you started. Moreover, library calls like <em>printf()</em> may ultimately call system calls like <em>write()</em>. Finally, C was designed before dynamic linking of libraries was commonplace. As a result, before a program is fully loaded, the compiler may not be able to tell whether a call outside the program’s address space is to a library or a system call.</p>

<p>Mostly you just need to read the developer documentation to determine what are the system calls that are available in any specific version of Linux (because they change from version to version). We’ll discuss a few system calls that are almost assured implemented in any version of Linux as system calls and not libraries.</p>


                </div>
                <div class="read-all">
                    <a  href="/2017/06/08/System-Calls/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h1>
                  <a class="post-link" href="/2017/06/08/Kthreads/">Kthreads</a>
                </h1>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-06-08
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>Yanxi Chen
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Operating System" title="Category: Operating System" rel="category">Operating System</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Thread" title="Tag: Thread" rel="tag">Thread</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#the-kthreads-library" id="markdown-toc-the-kthreads-library">The Kthreads Library</a>    <ul>
      <li><a href="#the-interface" id="markdown-toc-the-interface">The Interface</a></li>
    </ul>
  </li>
</ul>

<h1 id="the-kthreads-library">The Kthreads Library</h1>

<p>Kthreads is a relatively simple, non-preemptive threads library that we will be using to implement our operating system later in the labs. For our purposes, it has an advantage over pthreads because it works in the debugger and because it will not interfere with the simulator (making your development life easier). It’s also simple enough to understand, and therefore makes for a good teaching tool.</p>

<p>The kthreads library is at <strong>/cs/faculty/rich/cs170/lib/libkt.a</strong>, the source is at <strong>/cs/faculty/rich/cs170/src/libkt/</strong>, and the header is <strong>/cs/faculty/rich/cs170/include</strong>. You will also need to link to <strong>/cs/faculty/rich/cs170/lib/libfdr.a</strong> which provides some basic C functions like linked lists and red-black trees.</p>

<hr />

<h2 id="the-interface">The Interface</h2>

<p>Using kthreads is pretty straightforward, so we will not go into it in much detail. You should all understand the basic thread primitives by now although you need to remember that (unlike in the case of pthreads) kthreads do not pre-empt each other. The kthreads calls are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">void *kt_fork(void *(*func)(void *), void *arg);</code></li>
  <li><code class="language-plaintext highlighter-rouge">void kt_exit();</code></li>
  <li><code class="language-plaintext highlighter-rouge">void kt_join(void *kt_id);</code></li>
  <li><code class="language-plaintext highlighter-rouge">void kt_joinall();</code></li>
  <li><code class="language-plaintext highlighter-rouge">void *kt_self();</code></li>
  <li><code class="language-plaintext highlighter-rouge">void kt_yield();</code></li>
  <li><code class="language-plaintext highlighter-rouge">void kt_sleep(int sec);</code></li>
</ul>

<p>Kthreads includes <a href="http://www.cs.ucsb.edu/~rich/class/cs170/notes/Semaphores/index.html">counting semaphores</a> as its only synchronization primitive.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">kt_sem make_kt_sem(int initval);</code></li>
  <li><code class="language-plaintext highlighter-rouge">void kill_kt_sem(kt_sem ksem);</code></li>
  <li><code class="language-plaintext highlighter-rouge">void P_kt_sem(kt_sem ksem);</code></li>
  <li><code class="language-plaintext highlighter-rouge">void V_kt_sem(kt_sem ksem);</code></li>
  <li><code class="language-plaintext highlighter-rouge">int kt_getval(kt_sem s);</code></li>
</ul>

<p>The basic kt primitives (fork, exit, join) play the same role that pthread_create, pthread_exit, and pthread_join play for pthreads. Of the other functions, <code class="language-plaintext highlighter-rouge">kt_yield()</code> interrupts the current thread and lets the scheduler run a new one. This primitive is nice in non-pre-emptive thread systems because it allows a kind of “polling” of the scheduler. A thread calling <code class="language-plaintext highlighter-rouge">kt_yield()</code> blocks itself and allows other threads that can run to go ahead. When no more runnable threads are available, the yielding thread will be resumed at the point of the yield.</p>

<p>The call <code class="language-plaintext highlighter-rouge">kt_sleep()</code> sleeps the current thread for a specified time period. Again, because the thread is non-pre-emptive, the thread will be “awakened” and made runnable after the specified time, but it will not actually run until it is given the CPU.</p>

<p>The call <code class="language-plaintext highlighter-rouge">kt_self()</code> returns the thread id. No confusion here.</p>

<p>The function <code class="language-plaintext highlighter-rouge">kt_joinall()</code> is a useful function that causes the current thread to block until all other threads have either exited or blocked on a semaphore.</p>

<p>You will find that this function is particularly handy in designing your OS.</p>

<p>The semaphore primitives are exactly as we discussed. <code class="language-plaintext highlighter-rouge">make_kt_sem()</code> creates a semaphore with a value greater than or equal to zero, and <code class="language-plaintext highlighter-rouge">kill_kt_sem()</code> destroys (and frees) it. <code class="language-plaintext highlighter-rouge">P_kt_sem()</code> decrements the semaphore’s value by 1, and if it is negative blocks it. <code class="language-plaintext highlighter-rouge">V_kt_sem()</code> increments the value by one, and it if it is zero or less it unblocks one thread.</p>

<p>There is also a call to interrogate the current value of the semaphore – <code class="language-plaintext highlighter-rouge">kt_getval()</code>. While not strictly part of the semaphore API, there are occasions where the ability to know how many threads are blocked on a semaphore is quite handy.</p>

<hr />


                </div>
                <div class="read-all">
                    <a  href="/2017/06/08/Kthreads/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h1>
                  <a class="post-link" href="/2017/06/08/Semaphore/">Semaphore</a>
                </h1>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-06-08
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>Yanxi Chen
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Operating System" title="Category: Operating System" rel="category">Operating System</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Thread" title="Tag: Thread" rel="tag">Thread</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#synchronization" id="markdown-toc-synchronization">Synchronization</a></li>
</ul>

<h2 id="synchronization">Synchronization</h2>

<p>So far we have discussed mutexes and condition variables as the tools of synchronization and of managing critical sections of code. These are not the only tools that can be used for the job, and you are going to find yourselves very soon doing a lab where mutexes and condition variables are not available to you, but semaphores are. So we need to consider semaphores.</p>

<p>The concept of semaphores as used in computer synchronization is due to the Dutch computer scientist Edsgar Dijkstra. They have the advantages of being very simple, but sufficient to construct just about any other synchronization function you would care to have; we will cover a few of them here. There are several versions of the semaphore idea in common use, and you may run into variants from time to time. The end of these notes briefly describe two of the most common, binary semaphores and the SYSV IPC semaphores.</p>

<p>A semaphore is an integer with a difference. Well, actually a few differences.</p>

<ul>
  <li>You set the value of the integer when you create it, but can never access the value directly after that; you must use one of the semaphore functions to adjust it, and you cannot ask for the current value.</li>
  <li>There are semaphore functions to increment or decrement the value of the integer by one.</li>
  <li>Decrementing is a (possibly) blocking function. If the resulting semaphore value is negative, the calling thread or process is blocked, and cannot continue until some other thread or process increments it.</li>
  <li>Incrementing the semaphore when it is negative causes one (and only one) of the threads blocked by this semaphore to become unblocked and runnable.</li>
  <li>All semaphore operations are atomic.</li>
</ul>

<p>There are various ways that these operations are named and described, more or less interchangeably. This can be confusing, but such things happen in computer science when we try to use metaphors, especially multiple metaphors, to describe what a program is doing. Here are some:</p>

<dl>

<dt>**Increment**</dt>

<dd>Dijkstra called this function **<font color="green">V()</font>**; it is also called signal, unlock, leave or release.</dd>

<dt>**Decrement**</dt>

<dd>Dijkstra called this function **<font color="green">P()</font>**; it is also called wait, lock, enter, or get.</dd>

</dl>


                </div>
                <div class="read-all">
                    <a  href="/2017/06/08/Semaphore/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
        </ul>



        <!-- Pagination links -->
        <div class="pagination">
          
            <a href="/index.html" class="previous"><i class="fa fa-angle-double-left"></i></a>
            <a href="/page7" class="previous"><i class="fa fa-angle-left"></i></a>
          
          <span class="page_number">
             <script>
                function isNum(val){
                   if(val === "" || val ==null){
                      return false;
                   }
                   if(!isNaN(val)){
                      return true;
                   }
                   else{
                      return false;
                   }
                }
             </script>
             <script>
                function onPressEnter(){
                   var pageid = document.getElementById("page_jumper_input").value
                   if(isNum(pageid)==false){
                      alert("Invalid Page Number!")
                      return
                   }
                   number = parseInt(pageid)
                   minn = 1
                   maxn = 9
                   if(number < minn)
                      number = minn
                   if(number > maxn)
                      number = maxn
                   if(number == 1)
                      location.href='/'
                   else
                      location.href='/page'+number.toString()
                }
             </script>
            <input id="page_jumper_input" onkeydown="if(event.keyCode==13) {onPressEnter()}"
                  placeholder="8">/9
          </span>
          
            <a href="/page9" class="next"><i class="fa fa-angle-right"></i></a>
            <a href="/page9" class="next"><i class="fa fa-angle-double-right"></i></a>
          
        </div>
    </div>
    <!-- <button class="anchor"><i class="fa fa-anchor"></i></button> -->
    <div class="right">
        <div class="wrap">

            <div class="side">
                <div>
    <i class="fa fa-search"></i>
    Search
</div>
<div id="site_search">
    <input type="text" id="search_box" placeholder="Search..." >
</div>
<div id="search_results"></div>

<link rel="stylesheet" type="text/css" href="https://www.gaeblog.com/assets/stylesheets/main.css">
<script type="text/javascript" src="https://www.gaeblog.com/assets/js/search.js"></script>
<script type="text/javascript" src="https://www.gaeblog.com/assets/js/node_modules/simpleblogsearch/index.js"></script>

<script>
SimpleBlogSearch({
   searchDataPath: '/assets/search_data.json',
   dataType: 'json',
   processDataFunc: function(data){ return data },
   searchInputID: 'search_box',
   resultsDivID: 'search_results',
   resultULClass: 'content-ul search-ul content-side',
   highlightKeywordClass: 'search_keyword',
   limit: 4,

});
</script>

            </div>

            <div class="side">
                <div>
                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    Recent Posts
                </div>
                <ul class="content-ul" recent>
                    
                        <li><a href="/2021/03/09/Some-Personal-Updates/">Some personal updates</a></li>
                    
                        <li><a href="/2019/08/15/Data-Encoding-and-Transmission/">Data Encoding and Transmission- Part 2 of Designing Data-Intensive Applications</a></li>
                    
                        <li><a href="/2019/08/15/Data-Models-Querys-and-Storage/">Data Models, Querys, and Storage - Part 1 of Designing Data-Intensive Applications</a></li>
                    
                        <li><a href="/2019/07/24/Streaming-Systems/">Streaming Systems</a></li>
                    
                        <li><a href="/2019/01/22/Cost-Semantics/">Cost Semantics for Parallelism</a></li>
                    
                        <li><a href="/2019/01/21/imperative-programming/">Imperative Programming - Algol</a></li>
                    
                        <li><a href="/2019/01/20/Recursive-Types/">Recursive Types</a></li>
                    
                        <li><a href="/2019/01/20/Jekyll-Search-Solutions/">Jekyll Search Solutions</a></li>
                    
                        <li><a href="/2019/01/18/Recursive-Programs/">Recursive Programs</a></li>
                    
                        <li><a href="/2018/09/30/Logical-Equivalence-for-Polymorphic-Types/">Parametricity - Logical Equivalence for Polymorphic Types</a></li>
                    
                </ul>
            </div>

            <!-- Content -->
            <div class="side ">
                <div>
                    <i class="fa fa-th-list"></i>
                    Categories
                </div>
                <ul class="content-ul" cate>
                    
                    <li>
                        <a href="/category/#Random" class="categories-list-item" cate="Random">
                            <span class="name">
                                Random
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Operating System" class="categories-list-item" cate="Operating System">
                            <span class="name">
                                Operating System
                            </span>
                            <span class="badge">10</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Cloud Computing" class="categories-list-item" cate="Cloud Computing">
                            <span class="name">
                                Cloud Computing
                            </span>
                            <span class="badge">6</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Software-Defined Networking" class="categories-list-item" cate="Software-Defined Networking">
                            <span class="name">
                                Software-Defined Networking
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Virtualization" class="categories-list-item" cate="Virtualization">
                            <span class="name">
                                Virtualization
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Programming Languages" class="categories-list-item" cate="Programming Languages">
                            <span class="name">
                                Programming Languages
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Virtual Machine" class="categories-list-item" cate="Virtual Machine">
                            <span class="name">
                                Virtual Machine
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Interpreter" class="categories-list-item" cate="Interpreter">
                            <span class="name">
                                Interpreter
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Compiler" class="categories-list-item" cate="Compiler">
                            <span class="name">
                                Compiler
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Profiler" class="categories-list-item" cate="Profiler">
                            <span class="name">
                                Profiler
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Algorithm" class="categories-list-item" cate="Algorithm">
                            <span class="name">
                                Algorithm
                            </span>
                            <span class="badge">5</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Statistics" class="categories-list-item" cate="Statistics">
                            <span class="name">
                                Statistics
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Game Theory" class="categories-list-item" cate="Game Theory">
                            <span class="name">
                                Game Theory
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Garbage Collection" class="categories-list-item" cate="Garbage Collection">
                            <span class="name">
                                Garbage Collection
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Programming Language Theory" class="categories-list-item" cate="Programming Language Theory">
                            <span class="name">
                                Programming Language Theory
                            </span>
                            <span class="badge">14</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Proof Theory" class="categories-list-item" cate="Proof Theory">
                            <span class="name">
                                Proof Theory
                            </span>
                            <span class="badge">3</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Type Theory" class="categories-list-item" cate="Type Theory">
                            <span class="name">
                                Type Theory
                            </span>
                            <span class="badge">8</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Category Theory" class="categories-list-item" cate="Category Theory">
                            <span class="name">
                                Category Theory
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Jekyll" class="categories-list-item" cate="Jekyll">
                            <span class="name">
                                Jekyll
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Distributed System" class="categories-list-item" cate="Distributed System">
                            <span class="name">
                                Distributed System
                            </span>
                            <span class="badge">3</span>
                        </a>
                    </li>
                    
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <div class="side">
                <div>
                    <i class="fa fa-tags"></i>
                    Tags
                </div>
                <div class="tags-cloud">
                    
                    
                    
                    

                    

                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Thread" style="font-size: 11.5pt; color: #666;">Thread</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Syscall" style="font-size: 9pt; color: #999;">Syscall</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Memory" style="font-size: 9pt; color: #999;">Memory</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#File System" style="font-size: 9pt; color: #999;">File System</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#AWS" style="font-size: 9pt; color: #999;">AWS</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#IaaS" style="font-size: 9pt; color: #999;">IaaS</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#SDN" style="font-size: 9pt; color: #999;">SDN</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Virtualization" style="font-size: 9pt; color: #999;">Virtualization</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Container" style="font-size: 9pt; color: #999;">Container</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Slides" style="font-size: 12pt; color: #666;">Slides</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#PaaS" style="font-size: 9pt; color: #999;">PaaS</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Programming Languages" style="font-size: 18pt; color: #000;">Programming Languages</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Virtual Machine" style="font-size: 9pt; color: #999;">Virtual Machine</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Interpreter" style="font-size: 9.5pt; color: #888;">Interpreter</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Compiler" style="font-size: 9pt; color: #999;">Compiler</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Profiler" style="font-size: 9pt; color: #999;">Profiler</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Algorithm" style="font-size: 11.5pt; color: #666;">Algorithm</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#赫炎" style="font-size: 9pt; color: #999;">赫炎</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Quantum" style="font-size: 9pt; color: #999;">Quantum</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Statistics" style="font-size: 9pt; color: #999;">Statistics</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Game Theory" style="font-size: 9.5pt; color: #888;">Game Theory</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Math" style="font-size: 11pt; color: #777;">Math</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Mosh" style="font-size: 9pt; color: #999;">Mosh</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iTerm" style="font-size: 9pt; color: #999;">iTerm</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#tmux" style="font-size: 9pt; color: #999;">tmux</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Garbage Collection" style="font-size: 9pt; color: #999;">Garbage Collection</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Proof Theory" style="font-size: 10.5pt; color: #888;">Proof Theory</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Logic" style="font-size: 10.5pt; color: #888;">Logic</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Philosophy" style="font-size: 10.5pt; color: #888;">Philosophy</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Type Theory" style="font-size: 13.5pt; color: #444;">Type Theory</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Category Theory" style="font-size: 9pt; color: #999;">Category Theory</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#GIL" style="font-size: 9pt; color: #999;">GIL</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Jekyll" style="font-size: 9pt; color: #999;">Jekyll</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Blog" style="font-size: 9pt; color: #999;">Blog</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Books" style="font-size: 10.5pt; color: #888;">Books</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Distributed System" style="font-size: 10.5pt; color: #888;">Distributed System</a>
                    
                </div>
            </div>

            <!-- <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    Links
                </div>
                <ul  class="content-ul">

                </ul>
            </div> -->
        </div>
    </div>
</div>
<!-- <script src="/assets/js/scroll.min.js " charset="utf-8"></script> -->
<!-- <script src="/assets/js/pageContent.js " charset="utf-8"></script> -->


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
            
        </p>
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/SeraphRoy" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:royxagain@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>     
            <a href="https://www.facebook.com/SeraphRoy" title="Facebook"><i class="fa fa-facebook-official" aria-hidden="true"></i></a>   
            <a href="https://www.linkedin.com/in/yanxichen" title="LinkedIn"><i class="fa fa-linkedin" aria-hidden="true"></i></a>  
        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
            <span>
                Theme designed by <a href="https://github.com/Gaohaoyang">HyG</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /assets/js/main.js " charset="utf-8"></script>
    <script src=" /assets/js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
    <!-- <script src=" /assets/js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
